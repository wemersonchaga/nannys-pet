<div class="perfil-container" *ngIf="perfilTipo !== 'nenhum'; else escolhaPerfil">
  <h2>Bem-vindo(a), {{ userData?.nome }} {{ userData?.sobrenome }}</h2>

  <!-- Imagem de perfil -->
  <div class="text-center mb-3">
    <img 
      [src]="userData?.foto_perfil || 'https://nannys-backend.onrender.com/media/defaults/avatar_padrao.png'" 
      alt="Foto de perfil" 
      class="img-thumbnail rounded-circle" 
      width="150" height="150" />
  </div>

  <!-- Exibe informações do Tutor -->
  <div *ngIf="perfilTipo === 'tutor'" class="perfil-bloco">
    <p><i class="fas fa-envelope"></i> {{ userData?.email }}</p>

    <p *ngIf="userData?.data_nascimento; else nascimentoNaoInformado">
      <strong>Data de nascimento:</strong> {{ userData.data_nascimento | date:'dd/MM/yyyy' }}
    </p>
    <p *ngIf="userData?.data_nascimento">
      <strong>Idade:</strong> {{ calcularIdade(userData.data_nascimento) }} anos
    </p>
    <ng-template #nascimentoNaoInformado>
      <p><strong>Data de nascimento:</strong> Não informada</p>
    </ng-template>

    <p><strong>CPF:</strong> {{ userData?.cpf }}</p>

    <!-- Botões lado a lado -->
    <div class="d-flex gap-3 justify-content-center mt-4">
      <a routerLink="/pets/cadastrar" class="btn btn-primary flex-fill">+ Novo Pet</a>
      <button routerLink="/editar-perfil-tutor" class="btn btn-outline-secondary flex-fill">Editar Perfil de Tutor</button>
    </div>

    <!-- Lista de pets cadastrados -->
    <div *ngIf="pets.length > 0; else nenhumPet" class="mt-4">
      <h4>Meus Pets</h4>
      <ul class="list-group">
        <li *ngFor="let pet of pets" class="list-group-item d-flex justify-content-between align-items-center">
          <span>{{ pet.nome }}</span>
          <a [routerLink]="['/pets', pet.id]" class="btn btn-sm btn-outline-primary">Ver detalhes</a>
        </li>
      </ul>
    </div>

    <!-- Caso não tenha pets -->
    <ng-template #nenhumPet>
      <p class="text-muted mt-2 text-center">Você ainda não cadastrou nenhum pet.</p>
    </ng-template>
  </div>

  <!-- Exibe informações do Cuidador -->
  <div *ngIf="perfilTipo === 'cuidador'" class="perfil-bloco">
    <p><i class="fas fa-envelope"></i> {{ userData?.email }}</p>
    <p><strong>Data de nascimento:</strong> {{ userData?.data_nascimento || 'Não informado' }}</p>
    <p><strong>Cidade:</strong> {{ userData?.cidade || 'Não informado' }}</p>
    <p><strong>Estado:</strong> {{ userData?.estado || 'Não informado' }}</p>

    <p><strong>Instagram:</strong> 
      <a *ngIf="userData?.instagram" href="https://instagram.com/{{ userData.instagram }}" target="_blank" rel="noopener noreferrer">
        {{ userData.instagram }}
      </a>
      <span *ngIf="!userData?.instagram">Não informado</span>
    </p>

    <h2 class="text-xl font-bold mb-2">Ambiente de Hospedagem</h2>

    <p><strong>Descrição:</strong> {{ userData.descricao || 'Não informada' }}</p>
    <p><strong>Preço por diária:</strong> {{ userData.preco_diaria | currency:'BRL' }}</p>

    <p><strong>Características:</strong> {{ caracteristicasCuidadorFormatadas || 'Nenhuma característica cadastrada' }}</p>

    <p *ngIf="portesAceitosFormatados">
      <strong>Portes aceitos:</strong> {{ portesAceitosFormatados }}
    </p>

    <p><strong>Imagens do Ambiente:</strong></p>
    <div class="d-flex flex-wrap gap-2 mb-3">
      <img *ngFor="let img of userData?.imagens_ambiente" 
           [src]="img.foto" 
           alt="Imagem ambiente" 
           class="img-thumbnail" 
           style="width: 100px; height: 100px; object-fit: cover;" />
    </div>

    <p><strong>Média das avaliações:</strong> {{ userData?.media_avaliacoes || 'Sem avaliações' }}</p>
    <p><strong>Total de avaliações:</strong> {{ userData?.total_avaliacoes || 0 }}</p>

    <button routerLink="/editar-perfil-cuidador" class="btn mt-4">Editar Perfil de Cuidador</button>
  </div>
</div>

<!-- Mensagem de redirecionamento -->
<ng-template #escolhaPerfil>
  <div class="perfil-container text-center">
    <h2>Perfil não encontrado</h2>
    <p>Você ainda não criou um perfil como tutor ou cuidador.</p>
    <a routerLink="/escolher-perfil" class="btn btn-primary">Criar meu perfil</a>
  </div>
</ng-template>
